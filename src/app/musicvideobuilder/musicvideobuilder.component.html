<app-breadcrumb
    [links]="[{display:'Layer Finder', path:'layerFinder', icon:'search' }, {display:'Clip Builder', path:'clipBuilder', icon:'stack' }, {display:'Music Video Builder', path:'musicVideoBuilder', icon:'hammer' }]">
</app-breadcrumb>
<div class="container">
    <h1><i class="bi bi-hammer text-primary"></i> Music Video Builder</h1>
    <p class="lead">Music video builder allows you to combine clips to either make a new video or edit an existing
        one.
    </p>
    <p>Once you create a video in the editor then you can choose what resolution you want your video built in.
        Use
        the
        controls below to create or edit your videos</p>
    <app-pageloading [pageLoading]="pageLoading"></app-pageloading>
    <ng-container *ngIf="!pageLoading">
        <ng-container *ngIf="!showEditor && this.videos.length > 0">
            <h2>Saved Videos</h2>
            <div class="mb-3">
                <div class="row">
                    <div *ngFor="let video of videos; let i = index" class="col-sm mb-3">
                        <app-galleryvideo [video]="video" (buttonClickEvent)="editVideo($event, 100)"
                            [loading]="editorLoading" [displayLayers]="displayLayers">
                        </app-galleryvideo>
                    </div>
                </div>
            </div>
        </ng-container>
        <div *ngIf="!showEditor" class="mb-3">
            <span [ngbTooltip]="canAddVideoTooltip()" placement="right">
                <button type="button" class="btn btn-success" (click)="toggleEditor()" [disabled]="!canAddVideo()"><i
                        class="bi bi-plus-circle-fill"></i>
                    Add new video</button>
            </span>
        </div>
        <ng-container *ngIf="showEditor">
            <h2>Video Editor</h2>
            <div class="mb-3">
                <ngb-alert [type]="'info'" [dismissible]="false"><i class="bi bi-info-circle-fill"></i> Your
                    audio file must be of a constant bpm for this to work properly.</ngb-alert>
            </div>
            <div class="mb-3">
                <label for="audioFile" class="form-label">Audio File Selector</label>
                <input class="form-control" type="file" id="audioFile" accept=".mp3" (change)="onFileUpload($event)"
                    [disabled]="isWaitingForCreate" />
                <div class="form-text">
                    40 MB maximum file size. This is to add audio when you play your video in the final video player in
                    the timeline
                    section and is optional. If this is an existing
                    video you will need to select your track again as we don't keep hold of these files on our servers.
                    Also
                    limited to mp3 format due to browser restrictions.
                </div>
                <ng-container *ngIf="guessingBpm">
                    <label class="form-label">Guessing bpm from file</label>
                    <div class="progress">
                        <div class="progress-bar progress-bar-animated progress-bar-striped" role="progressbar"
                            aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 100%;"></div>
                    </div>
                </ng-container>
            </div>
            <div class="mb-3" *ngIf="guessedBpm && guessedVideoDelay">
                <ngb-alert [type]="'info'" [dismissible]="false"><i class="bi bi-info-circle-fill"></i> Our analysis
                    estimates your bpm as {{guessedBpm}} and video delay as {{guessedVideoDelay}} milliseconds.
                </ngb-alert>
            </div>

            <ul ngbNav #nav="ngbNav" class="nav-tabs mb-3" [(activeId)]="activeTabId" [destroyOnHide]="false"
                (navChange)="navChange($event)">
                <ng-container [formGroup]="videoForm">
                    <li [ngbNavItem]="1" [disabled]="isWaitingForCreate">
                        <a ngbNavLink><i class="bi bi-pencil-square"></i> Details</a>
                        <ng-template ngbNavContent>
                            <h3>Video Details</h3>
                            <div class="mb-3">
                                <label for="videoName" class="form-label">Video Name<span
                                        class="text-danger">*</span></label>
                                <input type="text" class="form-control" id="videoName"
                                    formControlName="videoNameControl" />
                                <div class="form-text">Try to pick something short. Has to be Alpha Numeric and unique
                                    across your
                                    videos.
                                </div>
                                <div class="form-text text-danger"
                                    *ngIf="videoNameControl?.invalid  && (videoNameControl?.dirty || videoNameControl?.touched)">
                                    <div [hidden]="!videoNameControl?.errors?.['required']">
                                        Video name is required.
                                    </div>
                                    <div [hidden]="!videoNameControl?.errors?.['maxlength']">
                                        Video name max length is 50 characters.
                                    </div>
                                    <div [hidden]="!videoNameControl?.errors?.['pattern']">
                                        Video name must be alpha numeric.
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="videoBpm" class="form-label">Video BPM (playback speed)<span
                                        class="text-danger">*</span></label>
                                <input type="number" class="form-control" min="90" max="250" step="1" id="videoBpm"
                                    formControlName="bpmControl" />
                                <div class="form-text">Must be between 90 and 250 beats per minute.
                                </div>
                                <div class="form-text text-danger"
                                    *ngIf="bpmControl?.invalid  && (bpmControl?.dirty || bpmControl?.touched)">
                                    <div [hidden]="!bpmControl?.errors?.['required']">
                                        BPM is required.
                                    </div>
                                    <div [hidden]="!bpmControl?.errors?.['min']">
                                        BPM must be over 90.
                                    </div>
                                    <div [hidden]="!bpmControl?.errors?.['max']">
                                        BPM must be under 250
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="format" class="form-label">Format</label>
                                <select id="format" formControlName="formatControl" class="form-control">
                                    <option [ngValue]="lt" *ngFor="let lt of formatList">
                                        {{Formats[lt]}}
                                    </option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label for="videoDelayMilliseconds" class="form-label">Video Delay in
                                    milliseconds</label>
                                <input type="number" class="form-control" min="0" max="2147483647" step="1"
                                    id="videoDelayMilliseconds" formControlName="videoDelayMillisecondsControl" />
                                <div class="form-text">This is the delay in milliseconds from the start of your audio to
                                    where the first
                                    beat kicks in. This will be when the video starts. Leave blank or 0 for no delay.
                                </div>
                                <div class="form-text text-danger"
                                    *ngIf="videoDelayMillisecondsControl?.invalid  && (videoDelayMillisecondsControl?.dirty || videoDelayMillisecondsControl?.touched)">
                                    <div [hidden]="!videoDelayMillisecondsControl?.errors?.['max']">
                                        Delay must be less than 2147483647.
                                    </div>
                                    <div [hidden]="!videoDelayMillisecondsControl?.errors?.['pattern']">
                                        Delay must be a positive whole numnber.
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <button type="button" [disabled]="!videoForm.valid || saving || noVideoEditorChanges()"
                                    class="btn btn-primary me-1" (click)="saveVideo()">
                                    <i class="bi bi-floppy-fill"></i> Save
                                    <span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true" *ngIf="saving"></span>
                                </button>
                                <span [ngbTooltip]="bpmInvalidTooltip()">
                                    <button type="button" [disabled]="disableTimelineTab()"
                                        class="btn btn-secondary me-1" (click)="setTabId(2)"><i
                                            class="bi bi-calendar3-week-fill"></i> Go to timeline</button>
                                </span>
                                <span [ngbTooltip]="noVideoEditorChangesTooltip()">
                                    <button type="button" [disabled]="!noVideoEditorChanges()"
                                        [ngClass]="noVideoEditorChanges() ? 'btn btn-primary' : 'btn btn-secondary'"
                                        (click)="setTabId(3)"><i class="bi bi-hammer"></i> Go to builder</button>
                                </span>
                            </div>
                            <div class="form-text text-danger mb-3"
                                *ngIf="videoForm.invalid && videoForm.errors?.['videoTooLong']">
                                Video must be less than {{videoForm.errors?.['videoTooLong']}} minutes long ignoring
                                delay
                            </div>
                        </ng-template>
                    </li>
                    <li [ngbNavItem]="2" [disabled]="disableTimelineTab()" [ngbTooltip]="bpmInvalidTooltip()"
                        (hidden)="stop()">
                        <a ngbNavLink><i class="bi bi-calendar3-week-fill"></i> Timeline</a>
                        <ng-template ngbNavContent>
                            <ng-container *ngIf="showEditor && !showClipPicker && clipsFormArray.length > 0">
                                <h3>Timeline View Options</h3>
                                <div class="mb-3">
                                    <label for="clipsPerBlock" class="form-label">Number of clips per timeline
                                        block</label>
                                    <select id="clipsPerBlock" class="form-control" [(ngModel)]="clipsPerBlock"
                                        [ngModelOptions]="{standalone: true}">
                                        <option [ngValue]="1">
                                            1
                                        </option>
                                        <option [ngValue]="4" [disabled]="isInvalidSelection(4)">
                                            4
                                        </option>
                                        <option [ngValue]="16" [disabled]="isInvalidSelection(16)">
                                            16
                                        </option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="timelineEditorStart" class="form-label">Timeline selection start, start
                                        of
                                        clip #
                                        {{timelineEditorStart}}</label>
                                    <input type="range" class="form-range" id="timelineEditorStart" min="1"
                                        [max]="clipsFormArray.length" [(ngModel)]="timelineEditorStart"
                                        [ngModelOptions]="{standalone: true}" (change)="timelineStartChange($event)">
                                </div>
                                <div class="mb-3">
                                    <label for="timelineEditorEnd" class="form-label">Timeline selection end, start of
                                        clip
                                        #
                                        {{timelineEditorEnd}}</label>
                                    <input type="range" class="form-range" id="timelineEditorEnd" min="2"
                                        [max]="clipsFormArray.length + 1" [(ngModel)]="timelineEditorEnd"
                                        [ngModelOptions]="{standalone: true}" (change)="timelineEndChange($event)">
                                </div>
                                <div class="mb-3" *ngIf="isInvalidSelection(4)">
                                    <ngb-alert [type]="'warning'" [dismissible]="false"><i
                                            class="bi bi-exclamation-triangle-fill"></i>{{getAlertText(4)}}</ngb-alert>
                                </div>
                                <div class="mb-3" role="alert" *ngIf="isInvalidSelection(16)">
                                    <ngb-alert [type]="'warning'" [dismissible]="false"><i
                                            class="bi bi-exclamation-triangle-fill"></i>{{getAlertText(16)}}</ngb-alert>
                                </div>
                                <div class="mb-3" *ngIf="this.clipsFormArray.length > 0">
                                    <h3>Timeline Blocks</h3>
                                    <div class="row">
                                        <ng-container
                                            *ngFor="let clipControl of this.clipsFormArray.controls; let i = index; let last = last">
                                            <div class="col-3 mb-3" *ngIf="showBlock(i)">
                                                <div class="card text-center">
                                                    <div class="imageContainer"
                                                        [style.background-color]="clipControl.value.backgroundColour !== null ? '#' + clipControl.value.backgroundColour : 'black'">
                                                        <ng-container
                                                            *ngFor="let clipDisplayLayer of clipControl.value.clipDisplayLayers; let j = index">
                                                            <ng-container
                                                                *ngFor="let layerloop of getLayers(clipDisplayLayer)">
                                                                <img [src]="storageUrl + '/' + layerloop.layerId + '/sprite.png'"
                                                                    [alt]="layerloop.layerId"
                                                                    [style.left.px]="calculateLeft(clipControl.value.startingBeat)"
                                                                    [style.z-index]="j + (layerloop.isOverlay === true ? 0 : 1)"
                                                                    [style.mix-blend-mode]="layerloop.isOverlay === true ? 'normal' : 'screen'"
                                                                    [style.filter]="'url(\'#' + j + '-' + clipControl.value.clipId + layerloop.layerId + '\')'"
                                                                    crossorigin="anonymous" />
                                                                <svg xmlns="http://www.w3.org/2000/svg">
                                                                    <filter
                                                                        [id]="j + '-' +clipControl.value.clipId + layerloop.layerId">
                                                                        <feColorMatrix type="matrix"
                                                                            [attr.values]="toColourMatrix(getColour(layerloop, clipControl.value))">
                                                                        </feColorMatrix>
                                                                    </filter>
                                                                </svg>
                                                            </ng-container>
                                                        </ng-container>
                                                        <img [src]="storageUrl + '/custom-pages/watermark.png'"
                                                            class="watermark" crossorigin="anonymous" />
                                                    </div>
                                                    <h5 class="card-header">{{calculateClipNameFromClipIndex(i)}}</h5>
                                                    <ul class="list-group list-group-flush">
                                                        <li class="list-group-item">
                                                            <span [ngbTooltip]="'Move back'"
                                                            *ngIf="i > 0 && i + clipsPerBlock <= clipsFormArray.length">
                                                            <button type="button" class="btn btn-secondary me-1"
                                                                (click)="moveBack(i)">
                                                                <i
                                                                    class="bi bi-arrow-left-circle-fill"></i></button>
                                                        </span>
                                                        <span [ngbTooltip]="'Remove'">
                                                            <button type="button" class="btn btn-danger me-1"
                                                                (click)="removeClip(i)">
                                                                <i class="bi bi-dash-circle-fill"></i></button>
                                                        </span>
                                                        <span [ngbTooltip]="'Move forward'"
                                                                *ngIf="i + 2 * clipsPerBlock <= clipsFormArray.length">
                                                                <button type="button" class="btn btn-secondary"
                                                                    (click)="moveForward(i)">
                                                                    <i
                                                                        class="bi bi-arrow-right-circle-fill"></i></button>
                                                            </span>
                                                        </li>
                                                        <li class="list-group-item">
                                                            
                                                            <span [ngbTooltip]="'Add clone after current'">
                                                                <button type="button" class="btn btn-success me-1"
                                                                    (click)="copyClip(i)">
                                                                    <i class="bi bi-files"></i></button>
                                                            </span>
                                                            <span [ngbTooltip]="'Swap this clip'"
                                                            *ngIf="clipsPerBlock === 1">
                                                                <button type="button" class="btn btn-primary me-1"
                                                                    (click)="toggleClipPicker(i)">
                                                                    <i class="bi bi-arrow-repeat"></i></button>
                                                            </span>
                                                            <span [ngbTooltip]="'Add new clip after this clip'"
                                                            *ngIf="clipsPerBlock === 1">
                                                                <button type="button" class="btn btn-success me-1"
                                                                    (click)="toggleAddClipPicker(i)">
                                                                    <i class="bi bi-node-plus-fill"></i></button>
                                                            </span>
                                                        </li>
                                                        <li class="list-group-item">
                                                            <span [ngbTooltip]="'Start player from here.'">
                                                                <button type="button" class="btn btn-info me-1"
                                                                    (click)="setSelectedClipIndex(i)"
                                                                    [disabled]="i === this.selectedClipIndex">
                                                                    <i class="bi bi-bookmark-star-fill"></i></button>
                                                            </span>
                                                            <span [ngbTooltip]="'Set quick timeline selection.'"
                                                                *ngIf="clipsPerBlock !== 1">
                                                                <button type="button" class="btn btn-secondary me-1"
                                                                    (click)="setQuickTimelineSelection(i)">
                                                                    <i class="bi bi-zoom-in"></i></button>
                                                            </span>
                                                            <span [ngbTooltip]="'Zoom out.'"
                                                                *ngIf="clipsPerBlock < 16 && clipsFormArray.length > (clipsPerBlock === 1 ? 4 : 16)">
                                                                <button type="button" class="btn btn-secondary me-1"
                                                                    (click)="zoomOut()">
                                                                    <i class="bi bi-zoom-out"></i></button>
                                                            </span>
                                                        </li>
                                                        <li class="list-group-item">
                                                            Beat #: {{calculateBeatRangeFromClipIndex(i)}}
                                                        </li>
                                                        <li class="list-group-item">
                                                            Time: {{displayTimeLineTimeRangeFromClipIndex(i) }}
                                                        </li>
                                                        <li class="list-group-item">
                                                            <div class="progress">
                                                                <div class="progress-bar" role="progressbar"
                                                                    aria-valuenow="0" aria-valuemin="0"
                                                                    aria-valuemax="100"
                                                                    [style.width.%]="getProgress(i, playingClipIndex, percentageOfPlayingClipDuration)">
                                                                </div>
                                                            </div>
                                                        </li>
                                                    </ul>
                                                </div>
                                            </div>
                                        </ng-container>
                                        <div class="form-text text-danger" *ngIf="clipsFormArray?.invalid">
                                            <div [hidden]="!clipsFormArray?.errors?.['maxlength']">
                                                You can't have more than 32767 clips in a video.
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <button type="button" (click)="toggleClipPicker(this.clipsFormArray.controls.length)" class="btn btn-success">
                                        <i class="bi bi-plus-circle-fill"></i> Pick clip to add to end of
                                        timeline</button>
                                </div>
                                <div class="mb-3">
                                    <h3>Final Video Player</h3>
                                    <app-videoplayer [selectedClipIndex]="selectedClipIndex" [video]="editorVideo"
                                        (setSelectedIndexEvent)="setSelectedClipIndex($event)" [displayLayers]="displayLayers"
                                        [file]="file"></app-videoplayer>
                                </div>
                            </ng-container>
                            <div class="mb-3" *ngIf="showClipPicker || clipsFormArray.length === 0">
                                <h3>Pick A Clip</h3>
                                <ngb-alert [type]="'warning'" [dismissible]="false" *ngIf="clipsFormArray.length === 0">
                                    <i class="bi bi-exclamation-triangle-fill"></i> To be able to save your video you
                                    must
                                    have at least one clip in your timeline.
                                </ngb-alert>
                                <p>This clip will be placed after all the other clips you have at the end of the
                                    timeline.
                                </p>
                                <div class="row">
                                    <div *ngFor="let clip of clips; let i = index" class="col-sm mb-3">
                                        <app-galleryplayer [clip]="clip" [bpm]="bpmControl.value"
                                            (addButtonClickClipEvent)="addClipPickerClip($event)"
                                            [collections]="collections">
                                        </app-galleryplayer>
                                    </div>
                                </div>
                                <button type="button" class="btn btn-danger" (click)="toggleClipPicker(0)"
                                    *ngIf="clipsFormArray.length > 0"><i class="bi bi-dash-circle-fill"></i>
                                    Cancel</button>
                            </div>
                            <div class="mb-3">
                                <button type="button" [disabled]="!videoForm.valid || saving || noVideoEditorChanges()"
                                    class="btn btn-primary me-1" (click)="saveVideo()">
                                    <i class="bi bi-floppy-fill"></i> Save
                                    <span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true" *ngIf="saving"></span>
                                </button>
                                <button type="button" class="btn btn-secondary me-1" (click)="setTabId(1)"><i
                                        class="bi bi-pencil-square"></i> Go to
                                    details</button>
                                <span [ngbTooltip]="noVideoEditorChangesTooltip()">
                                    <button type="button" [disabled]="!noVideoEditorChanges()"
                                        [ngClass]="noVideoEditorChanges() ? 'btn btn-primary' : 'btn btn-secondary'"
                                        (click)="setTabId(3)"><i class="bi bi-hammer"></i> Go to builder</button>
                                </span>
                            </div>
                            <div class="form-text text-danger mb-3"
                                *ngIf="videoForm.invalid && videoForm.errors?.['videoTooLong']">
                                Video must be less than {{videoForm.errors?.['videoTooLong']}} minutes long ignoring
                                delay
                            </div>
                        </ng-template>
                    </li>
                </ng-container>
                <ng-container [formGroup]="builderForm">
                    <li [ngbNavItem]="3" [disabled]="!noVideoEditorChanges()"
                        [ngbTooltip]="noVideoEditorChangesTooltip()">
                        <a ngbNavLink><i class="bi bi-hammer"></i> Builder</a>
                        <ng-template ngbNavContent>
                            <app-builddisplaystatus [file]="file" [isBuilding]="isBuilding" [isUploadingAudio]="isUploadingAudio"></app-builddisplaystatus>
                            <div>
                                <h3>Build Video</h3>
                                <div class="mb-3">
                                    <p>Use the options below to determine the resolution and license you want. Please
                                        remember that once you have a license you then only need to pay for build costs
                                        in
                                        future for the layers used.</p>
                                </div>
                                <div class="mb-3">
                                    <label for="resolution" class="form-label">Resolution</label>
                                    <select id="resolution" formControlName="resolutionControl" class="form-control"
                                        (change)="resolutionChange()">
                                        <option [ngValue]="resolution.resolution"
                                            *ngFor="let resolution of resolutionList">
                                            {{resolution.displayName}}
                                        </option>
                                    </select>
                                </div>
                                <div class="mb-3" *ngIf="canLicense">
                                    <label for="license" class="form-label">License</label>
                                    <select id="license" formControlName="licenseControl" class="form-control">
                                        <option [ngValue]="license" *ngFor="let license of licenseList">
                                            {{License[license]}}
                                        </option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <p>Cost</p>
                                    <ul class="list-group">
                                        <li class="list-group-item" *ngFor="let videoCollection of videoCollections">
                                            <h6 class="float-start">{{License[licenseControl.value]}} {{displayResolution(resolutionControl.value)}} license for
                                                collection: {{videoCollection.collectionName}}</h6>
                                            <h6 class="float-end">{{ getCollectionLicenseCost(videoCollection) | currency:"GBP":"symbol"}}
                                            </h6>
                                        </li>
                                        <li class="list-group-item">
                                            <h5 class="float-start">License Total</h5>
                                            <h5 class="float-end">{{collectionLicensesCost | currency:"GBP":"symbol"}}
                                            </h5>
                                        </li>
                                        <li class="list-group-item">
                                            <h5 class="float-start">Build Total</h5>
                                            <h5 class="float-end">{{buildCost | currency:"GBP":"symbol"}}</h5>
                                        </li>
                                        <li class="list-group-item">
                                            <h3 class="float-start">Total</h3>
                                            <h3 class="float-end">{{total | currency:"GBP":"symbol"}}</h3>
                                        </li>
                                    </ul>
                                </div>
                                <div class="mb-3">
                                    <button type="button" class="btn btn-primary" (click)="createFreeVideo()"
                                        [disabled]="isBuilding || isWaitingForCreate" *ngIf="total === 0">
                                        <i class="bi bi-hammer ms-1"></i>
                                        Create
                                        Video
                                        <span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true" *ngIf="isWaitingForCreate"></span>
                                    </button>
                                    <button type="button" class="btn btn-success" (click)="createPaymentIntent()"
                                        [disabled]="isBuilding || isWaitingForCreate" *ngIf="total > 0">
                                        <i class="bi bi-credit-card-fill ms-1"></i>
                                            Checkout
                                            <span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true" *ngIf="isWaitingForCreate"></span>
                                        </button>
                                </div>
                            </div>
                        </ng-template>
                    </li>
                    <li [ngbNavItem]="4" [disabled]="true" [ngbTooltip]="'Only accessable via builder screen'">
                        <a ngbNavLink><i class="bi bi-credit-card-fill"></i> Checkout</a>
                        <ng-template ngbNavContent>
                            <ng-container *ngIf="elementOptions?.clientSecret as clientSecret">
                                <app-builddisplaystatus [file]="file" [isBuilding]="isBuilding" [isUploadingAudio]="isUploadingAudio"></app-builddisplaystatus>
                                <h3>Checkout</h3>
                                <p>Please check all details before you pay</p>
                                <div class="mb-3">
                                    <p>Cost</p>
                                    <ul class="list-group">
                                        <li class="list-group-item" *ngFor="let videoCollection of videoCollections">
                                            <h6 class="float-start">{{License[licenseControl.value]}} license for
                                                collection: {{videoCollection.collectionName}}</h6>
                                            <h6 class="float-end">{{ getCollectionLicenseCost(videoCollection) | currency:"GBP":"symbol"}}
                                            </h6>
                                        </li>
                                        <li class="list-group-item">
                                            <h5 class="float-start">License Total</h5>
                                            <h5 class="float-end">{{collectionLicensesCost | currency:"GBP":"symbol"}}
                                            </h5>
                                        </li>
                                        <li class="list-group-item">
                                            <h5 class="float-start">Build Total</h5>
                                            <h5 class="float-end">{{buildCost | currency:"GBP":"symbol"}}</h5>
                                        </li>
                                        <li class="list-group-item">
                                            <h3 class="float-start">Total</h3>
                                            <h3 class="float-end">{{total | currency:"GBP":"symbol"}}</h3>
                                        </li>
                                    </ul>
                                </div>
                                <div class="mb-3">
                                    <ngx-stripe-payment [elementsOptions]="elementOptions" (change)="cardChange($event)"></ngx-stripe-payment>
                                </div>
                                <div class="mb-3">
                                    <button type="button" class="btn btn-success" (click)="pay()"
                                    [disabled]="isBuilding || isWaitingForCreate || invalidCardDetails" *ngIf="total > 0">
                                    <i class="bi bi-credit-card-fill" ms-1></i>
                                        Pay
                                        <span class="spinner-border spinner-border-sm ms-1" role="status" aria-hidden="true" *ngIf="isWaitingForCreate"></span>
                                    </button>
                                </div>
                            </ng-container>
                        </ng-template>
                    </li>
                </ng-container>
            </ul>
            <div [ngbNavOutlet]="nav"></div>
            <div class="mb-3">
                <button type="button" class="btn btn-danger" (click)="toggleEditor()" [disabled]="isWaitingForCreate"><i
                        class="bi bi-dash-circle-fill"></i>
                    Exit Editor</button>
            </div>

        </ng-container>
    </ng-container>
</div>